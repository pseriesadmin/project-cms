// ê°œì„ ëœ checkAndAutoRestore í•¨ìˆ˜
const checkAndAutoRestore = useCallback(async (showLoading = false, forceSync = false) => {
  // íŠ¸ë˜í”½ ìµœì í™”: ë™ê¸°í™” ì¼ì‹œ ì¤‘ë‹¨ ìƒíƒœì—ì„œëŠ” ê°•ì œ ë™ê¸°í™”ê°€ ì•„ë‹Œ ê²½ìš° ì¤‘ë‹¨
  if (pauseSync && !forceSync) {
    console.log('ğŸ›‘ [useProjectSync] ë™ê¸°í™” ì¼ì‹œ ì¤‘ë‹¨ ìƒíƒœ - íŠ¸ë˜í”½ ìµœì í™”');
    return;
  }
  
  if (showLoading) {
    setIsSyncing(true);
    console.log('ğŸ”„ [useProjectSync] ì´ˆê¸° ë³µì› ì‹œì‘ - ë¡œë”© í‘œì‹œ');
  }
  
  try {
    // 1. ë²„ì „ ì²´í¬ API í˜¸ì¶œ
    const response = await fetch('/api/version');
    if (!response.ok) {
      console.log('ğŸ“ [useProjectSync] ë²„ì „ ì²´í¬ API ì˜¤ë¥˜ - ë¡œì»¬ ë°ì´í„° ì‚¬ìš©');
      return;
    }
    
    const { latestVersion, hasUpdates } = await response.json();
    const localVersion = localStorage.getItem('project_version');
    const localData = localStorage.getItem('crazyshot_project_data');
    
    // 2. ë¡œì»¬ ë°ì´í„° ê²€ì¦ ë° í´ë°± ì²˜ë¦¬
    const hasValidLocalData = localData && 
      JSON.parse(localData).projectPhases && 
      JSON.parse(localData).projectPhases.length > 0;
    
    // 3. ë¡œì»¬ ë°ì´í„° ì—†ëŠ” ê²½ìš° í´ë¼ìš°ë“œ ë³µì› ì‹œë„
    if (!hasValidLocalData) {
      console.log('ğŸ“¥ [useProjectSync] ë¡œì»¬ ë°ì´í„° ì—†ìŒ - í´ë¼ìš°ë“œ ë³µì› ì‹œë„');
      
      try {
        const restoredData = await cloudRestore();
        
        if (restoredData) {
          console.log('âœ… [useProjectSync] í´ë¼ìš°ë“œ ë°±ì—…ìœ¼ë¡œë¶€í„° ë°ì´í„° ë³µì›');
          setProjectData(restoredData);
          localStorage.setItem('crazyshot_project_data', JSON.stringify(restoredData));
          localStorage.setItem('project_version', latestVersion);
          setCurrentVersion(latestVersion);
          return;
        } else {
          // í´ë¼ìš°ë“œì—ë„ ë°ì´í„° ì—†ìŒ - ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
          console.log('ğŸ“ [useProjectSync] í´ë¼ìš°ë“œì—ë„ ë°ì´í„° ì—†ìŒ - ê¸°ë³¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”');
          const defaultData = getSavedOrInitialData();
          setProjectData(defaultData);
          
          // ì²« ë°©ë¬¸ì´ë¯€ë¡œ ê¸°ë³¸ ë°ì´í„°ë¥¼ í´ë¼ìš°ë“œì— ë°±ì—…
          try {
            await cloudSave(defaultData);
            console.log('ğŸ’¾ [useProjectSync] ê¸°ë³¸ ë°ì´í„° í´ë¼ìš°ë“œ ë°±ì—… ì™„ë£Œ');
          } catch (backupError) {
            console.warn('âš ï¸ [useProjectSync] ê¸°ë³¸ ë°ì´í„° ë°±ì—… ì‹¤íŒ¨:', backupError);
          }
          return;
        }
      } catch (restoreError) {
        console.log('ğŸ“ [useProjectSync] í´ë¼ìš°ë“œ ë³µì› ì‹¤íŒ¨ - ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©:', restoreError);
        const defaultData = getSavedOrInitialData();
        setProjectData(defaultData);
        return;
      }
    }
    
    // 4. ë²„ì „ ì—…ë°ì´íŠ¸ ì²´í¬
    if (hasUpdates && localVersion !== latestVersion) {
      console.log('ğŸ“¥ [useProjectSync] ìƒˆ ë²„ì „ ê°ì§€ - ë°±ì—… ë³µì› ì‹œì‘');
      
      try {
        const restoredData = await cloudRestore();
        
        if (restoredData) {
          console.log('âœ… [useProjectSync] ë°±ì—… ë³µì› ì™„ë£Œ');
          setProjectData(restoredData);
          localStorage.setItem('project_version', latestVersion);
          setCurrentVersion(latestVersion);
        } else {
          console.log('ğŸ“ [useProjectSync] ìƒˆ ë²„ì „ì´ì§€ë§Œ í´ë¼ìš°ë“œ ë°ì´í„° ì—†ìŒ - ë¡œì»¬ ë°ì´í„° ìœ ì§€');
        }
      } catch (versionRestoreError) {
        console.log('ğŸ“ [useProjectSync] ë²„ì „ ì—…ë°ì´íŠ¸ ë³µì› ì‹¤íŒ¨ - ë¡œì»¬ ë°ì´í„° ìœ ì§€:', versionRestoreError);
      }
    }
    
  } catch (error) {
    console.log('ğŸ“ [useProjectSync] ì „ì²´ ë™ê¸°í™” í”„ë¡œì„¸ìŠ¤ ì˜¤ë¥˜ - ë¡œì»¬ ë°ì´í„° ìœ ì§€:', error);
  } finally {
    if (showLoading) {
      setIsSyncing(false);
      console.log('ğŸ”„ [useProjectSync] ì´ˆê¸° ë³µì› ì™„ë£Œ - ë¡œë”© í•´ì œ');
    }
  }
}, [cloudRestore, cloudSave, pauseSync, getSavedOrInitialData]);
